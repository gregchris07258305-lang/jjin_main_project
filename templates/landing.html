<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sseuk-Sseuk : ì§€ì—­ ì†Œì‹</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        /* [1] ì§€ë„ ì»¨í…Œì´ë„ˆ */
        #svg-container { perspective: 1000px; overflow: visible; }
        #svg-container svg {
            width: 100%; height: auto; max-height: 75vh;
            overflow: visible; display: block; transform-origin: center center;
        }

        /* [2] í¼ì¦ ì¡°ê° (Gíƒœê·¸ì™€ Pathíƒœê·¸ ëª¨ë‘ í˜¸í™˜ë˜ë„ë¡ ì„¤ì •) */
        .puzzle-piece { cursor: pointer; transform-style: preserve-3d; transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); }
        
        /* Gíƒœê·¸ê°€ puzzle-pieceì¼ ë•Œ ë‚´ë¶€ Path ìŠ¤íƒ€ì¼ */
        g.puzzle-piece path { 
            fill: #ffffff; stroke: #4A9EA8; stroke-width: 1px; 
            filter: drop-shadow(0px 4px 0px #4A9EA8) drop-shadow(0px 5px 5px rgba(0, 0, 0, 0.1)); 
            transition: all 0.4s ease; 
        }
        
        /* Path ìì²´ê°€ puzzle-pieceì¼ ë•Œ ìŠ¤íƒ€ì¼ */
        path.puzzle-piece {
            fill: #ffffff; stroke: #4A9EA8; stroke-width: 1px; 
            filter: drop-shadow(0px 4px 0px #4A9EA8) drop-shadow(0px 5px 5px rgba(0, 0, 0, 0.1)); 
            transition: all 0.4s ease; 
        }

        /* í˜¸ë²„ íš¨ê³¼ */
        .puzzle-piece:hover { transform: translateZ(20px) translateY(-15px); z-index: 50; }
        .puzzle-piece:hover path, path.puzzle-piece:hover { 
            filter: drop-shadow(0px 15px 0px #4A9EA8) drop-shadow(0px 25px 30px rgba(74, 158, 168, 0.4)); 
        }

        /* [3] ë¹„í™œì„± ì˜ì—­ */
        .region-disabled { pointer-events: none; opacity: 0.5; }
        .region-disabled path, path.region-disabled { fill: #eeeeee; stroke: #dddddd; filter: none; }

        /* [4] íˆ´íŒ */
        #info-tooltip { position: absolute; top: 0; left: 0; pointer-events: none; z-index: 100; display: none; align-items: center; }
        .tooltip-line { height: 1px; background-color: #4A9EA8; box-shadow: 0 0 5px #4A9EA8; }
        .tooltip-content { display: flex; flex-direction: column; opacity: 0; }
        .tooltip-badge { font-size: 10px; background-color: #E0BA76; color: white; padding: 2px 6px; border-radius: 9999px; margin-bottom: 4px; font-weight: bold; width: fit-content; }
        .tooltip-title { font-size: 1.5rem; font-weight: 800; color: #374151; line-height: 1; margin-bottom: 4px; }
        .tooltip-count { font-size: 1rem; color: #6B7280; font-weight: 500; }
        .tooltip-count span { color: #4A9EA8; font-weight: 700; }

        /* ì˜¤ë²„ë ˆì´ */
        #transition-overlay { position: fixed; inset: 0; background-color: white; z-index: 9999; pointer-events: none; opacity: 0; }

        /* ë°°ê²½ */
        body {
            background-color: #f9fafb;
            background-image: 
                radial-gradient(#4A9EA8 1.5px, transparent 1.5px),
                radial-gradient(#F48245 1.5px, transparent 1.5px),
                radial-gradient(#D9B36C 1.5px, transparent 1.5px);
            background-size: 75px 75px;
            background-position: 0 0, 25px 25px, 50px 50px;
            animation: particleMove 60s linear infinite;
        }
        @keyframes particleMove {
            0% { background-position: 0 0, 25px 25px, 50px 50px; }
            100% { background-position: 750px 0, 775px 25px, 800px 50px; }
        }
    </style>
</head>

<body class="text-gray-900 overflow-hidden h-screen flex flex-col relative">

    <div id="transition-overlay"></div>

    <div id="intro-gate" class="fixed inset-0 z-[60] flex flex-col items-center justify-center bg-gray-50/80 backdrop-blur-sm transition-all duration-700 hidden">
        <div class="text-center space-y-6 opacity-0 translate-y-10" id="intro-content">
            <div class="space-y-2">
                <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 tracking-tight">
                    ë‹¹ì‹ ì˜ <span class="text-[#4A9EA8]">ì§€ì—­</span>ì„<br>ì„ íƒí•´ì£¼ì„¸ìš”
                </h1>
                <p class="text-gray-500 text-lg">ë‚´ê°€ ì‚¬ëŠ” ê³³ì˜ ì²­ë…„ ì •ì±…ì„ ê°€ì¥ ì‰½ê³  ë¹ ë¥´ê²Œ.</p>
            </div>
            <div class="flex flex-col gap-3 w-full max-w-xs mx-auto">
                <button id="btn-start" class="w-full py-4 bg-[#4A9EA8] hover:bg-[#3b858e] text-white font-bold rounded-xl shadow-lg shadow-teal-500/30 transition-all hover:-translate-y-1 text-lg">
                    ì§€ë„ì—ì„œ ì§€ì—­ ì°¾ê¸° ğŸ—ºï¸
                </button>
            </div>
        </div>
    </div>

    <div id="back-nav" class="fixed top-6 left-6 z-50 hidden">
        <button onclick="window.location.href='/'" class="flex items-center gap-2 px-4 py-2 bg-white/90 backdrop-blur rounded-full shadow-lg border border-gray-100 hover:bg-[#4A9EA8] hover:text-white transition-all group cursor-pointer">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 transition-transform group-hover:-translate-x-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
            <span class="font-bold text-sm">ì „êµ­ì§€ë„ ë³´ê¸°</span>
        </button>
    </div>

    <div id="info-tooltip">
        <div class="tooltip-line"></div>
        <div class="tooltip-content">
            <span class="tooltip-badge">Region</span>
            <h3 class="tooltip-title">ì§€ì—­ëª…</h3>
            <p class="tooltip-count">ë°ì´í„° : <span>0</span>ê±´</p>
        </div>
    </div>

    <div id="main-content" class="relative w-full h-full flex flex-col items-center justify-center opacity-0 hidden p-4">
        <header class="text-center z-10 flex-none mb-6 md:mb-10 pointer-events-none">
            <h1 class="text-3xl md:text-4xl font-bold tracking-tighter mb-2" id="header-title">ì“±ì“± í”„ë¡œì íŠ¸</h1>
            <p class="text-sm md:text-base text-gray-500" id="header-desc">ì§€ë„ë¥¼ í´ë¦­í•˜ì—¬ ì§€ì—­ë³„ ë‰´ìŠ¤ë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
        </header>
        <main id="svg-container" class="w-full max-w-5xl flex items-center justify-center flex-1">
            </main>
    </div>

    <script>
        // =========================================================================
        // [1] ë°ì´í„° ì„¤ì • (ë³´ë‚´ì£¼ì‹  ìµœì‹  ì§€ì—­ëª… ë°˜ì˜)
        // =========================================================================
        const REGION_DATA = {
            // â˜… ì „êµ­ ì§€ë„ ì„¤ì • (Keyê°€ ê³§ G ID)
            'national': {
                mapPath: '/static/images/map.svg',
                title: 'ì „êµ­ ì†Œì‹',
                desc: 'ì§€ë„ë¥¼ í´ë¦­í•˜ì—¬ ì§€ì—­ë³„ ë‰´ìŠ¤ë¥¼ í™•ì¸í•˜ì„¸ìš”',
                db: {
                    // Case 2: ìƒì„¸ ì§€ë„ë¡œ ë„˜ì–´ê°ˆ ì§€ì—­ë“¤
                    'metropolitan': { name: 'ì„œìš¸/ê²½ê¸°/ì¸ì²œ', count: 4250 },
                    'chungnam': { name: 'ì¶©ë‚¨/ëŒ€ì „/ì„¸ì¢…', count: 589 },
                    'jeonnam': { name: 'ì „ë‚¨/ê´‘ì£¼', count: 340 },
                    'gyeongbug': { name: 'ê²½ë¶/ëŒ€êµ¬', count: 781 },
                    'gyeongnam': { name: 'ê²½ë‚¨/ë¶€ì‚°/ìš¸ì‚°', count: 890 },
                    
                    // Case 1: ë°”ë¡œ main.htmlë¡œ ì—°ê²°ë  ì§€ì—­ë“¤
                    'gangwon': { name: 'ê°•ì›ë„', count: 231 },
                    'chungbug': { name: 'ì¶©ì²­ë¶ë„', count: 412 },
                    'jeonbug': { name: 'ì „ë¼ë¶ë„', count: 620 },
                    'jeju': { name: 'ì œì£¼íŠ¹ë³„ìì¹˜ë„', count: 156 }
                },
                // íˆ´íŒ ë°©í–¥ ì„¤ì • (ì™¼ìª½ ì§€ì—­)
                leftSideIds: ['metropolitan', 'chungnam', 'jeonbug', 'jeonnam', 'jeju']
            },

            // â˜… ìƒì„¸ ì§€ë„ ì„¤ì • (Keyê°€ ê³§ Path ID, íŒŒì¼ì´ ìˆëŠ” ì§€ì—­ë§Œ ì •ì˜)
            'metropolitan': {
                mapPath: '/static/images/total_metropolitan.svg',
                title: 'ìˆ˜ë„ê¶Œ ìƒì„¸',
                desc: 'ì§€ì—­ì„ ì„ íƒí•˜ì„¸ìš”',
                db: {
                    'detail_seoul': { name: 'ì„œìš¸íŠ¹ë³„ì‹œ', count: 1200 },
                    'detail_incheon': { name: 'ì¸ì²œê´‘ì—­ì‹œ', count: 450 },
                    'detail_gyeonggi': { name: 'ê²½ê¸°ë„', count: 2100 }
                }
            },
            'chungnam': {
                mapPath: '/static/images/total_chungnam.svg',
                title: 'ì¶©ë‚¨/ëŒ€ì „/ì„¸ì¢… ìƒì„¸',
                desc: 'ì§€ì—­ì„ ì„ íƒí•˜ì„¸ìš”',
                db: {
                    'detail_daejun': { name: 'ëŒ€ì „ê´‘ì—­ì‹œ', count: 320 },
                    'detail_saejong': { name: 'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ', count: 150 },
                    'detail_chungnam': { name: 'ì¶©ì²­ë‚¨ë„', count: 480 }
                }
            },
            'jeonnam': {
                mapPath: '/static/images/total_jeonnam.svg',
                title: 'ì „ë‚¨/ê´‘ì£¼ ìƒì„¸',
                desc: 'ì§€ì—­ì„ ì„ íƒí•˜ì„¸ìš”',
                db: {
                    'detail_gwangju': { name: 'ê´‘ì£¼ê´‘ì—­ì‹œ', count: 290 },
                    'detail_jeonnam': { name: 'ì „ë¼ë‚¨ë„', count: 310 }
                }
            },
            'gyeongbug': {
                mapPath: '/static/images/total_gyeongbug.svg',
                title: 'ê²½ë¶/ëŒ€êµ¬ ìƒì„¸',
                desc: 'ì§€ì—­ì„ ì„ íƒí•˜ì„¸ìš”',
                db: {
                    'detail_daegu': { name: 'ëŒ€êµ¬ê´‘ì—­ì‹œ', count: 410 },
                    'detail_gyeongbug': { name: 'ê²½ìƒë¶ë„', count: 520 }
                }
            },
            'gyeongnam': {
                mapPath: '/static/images/total_gyeongnam.svg',
                title: 'ê²½ë‚¨/ë¶€ì‚°/ìš¸ì‚°',
                desc: 'ì§€ì—­ì„ ì„ íƒí•˜ì„¸ìš”',
                db: {
                    'detail_busan': { name: 'ë¶€ì‚°ê´‘ì—­ì‹œ', count: 680 },
                    'detail_ulsan': { name: 'ìš¸ì‚°ê´‘ì—­ì‹œ', count: 210 },
                    'detail_gyeongnam': { name: 'ê²½ìƒë‚¨ë„', count: 550 }
                }
            }
        };

        const urlParams = new URLSearchParams(window.location.search);
        const currentRegionKey = urlParams.get('region') || 'national';
        const currentConfig = REGION_DATA[currentRegionKey] || REGION_DATA['national'];
        const isDetailMode = currentRegionKey !== 'national';
        let tooltipTimeline = null;

        // =========================================================================
        // [2] í•µì‹¬ ë¡œì§
        // =========================================================================
        function initMapEvents() {
            const svgElement = document.querySelector('#svg-container svg');
            if (!svgElement) return;

            const tooltip = document.querySelector('#info-tooltip');
            const tooltipLine = tooltip.querySelector('.tooltip-line');
            const tooltipContent = tooltip.querySelector('.tooltip-content');
            const tTitle = tooltip.querySelector('.tooltip-title');
            const tCountSpan = tooltip.querySelector('.tooltip-count span');
            const overlay = document.getElementById('transition-overlay');

            const activeIds = Object.keys(currentConfig.db);
            console.log(`[Init] Mode: ${currentRegionKey}, Looking for:`, activeIds);

            const allElements = svgElement.querySelectorAll('g, path');

            allElements.forEach(element => {
                const rawId = element.id || '';
                const regionId = rawId.trim();

                if (!regionId) return;

                // [ì „êµ­ ëª¨ë“œ í•„í„°ë§] _st ID ë¬´ì‹œ
                if (!isDetailMode) {
                    if (regionId.endsWith('_st')) return; 
                }

                // [ìƒì„¸ ëª¨ë“œ í•„í„°ë§] total_, .svg ë¬´ì‹œ
                if (isDetailMode) {
                    if (regionId.startsWith('total_') || regionId.includes('.svg')) return; 
                }

                // [ëœë“œë§ˆí¬]
                if (regionId.toLowerCase().includes('lm')) {
                    element.classList.add('landmark-piece');
                    return; 
                }

                // [ë§¤ì¹­ ì„±ê³µ ì‹œ ì´ë²¤íŠ¸ ë°”ì¸ë”©]
                if (activeIds.includes(regionId)) {
                    element.classList.add('puzzle-piece');

                    // Hover Event
                    element.addEventListener('mouseenter', function() {
                        // z-index handling
                        if (this.tagName.toLowerCase() === 'path' || this.tagName.toLowerCase() === 'g') {
                             this.parentNode.appendChild(this); 
                        }
                        
                        const data = currentConfig.db[regionId] || { name: 'Unknown', count: 0 };
                        tTitle.innerText = data.name;
                        tCountSpan.innerText = data.count.toLocaleString();

                        const rect = element.getBoundingClientRect();
                        tooltip.style.display = 'flex';
                        
                        let isLeft = false;
                        if (!isDetailMode) {
                            isLeft = (currentConfig.leftSideIds || []).includes(regionId);
                        } else {
                            isLeft = (rect.left + rect.width/2) < (window.innerWidth / 2);
                        }
                        
                        if (isLeft) {
                            tooltip.style.flexDirection = 'row-reverse';
                            tooltipLine.style.marginRight = '0px'; tooltipLine.style.marginLeft = '10px'; tooltipLine.style.transformOrigin = 'right center';
                            tooltipContent.style.alignItems = 'flex-end';
                            const startX = rect.left + (rect.width * 0.2); const startY = rect.top + (rect.height * 0.3);
                            tooltip.style.left = 'auto'; tooltip.style.right = `${window.innerWidth - startX}px`; tooltip.style.top = `${startY}px`;
                        } else {
                            tooltip.style.flexDirection = 'row';
                            tooltipLine.style.marginRight = '10px'; tooltipLine.style.marginLeft = '0px'; tooltipLine.style.transformOrigin = 'left center';
                            tooltipContent.style.alignItems = 'flex-start';
                            const startX = rect.right - (rect.width * 0.2); const startY = rect.top + (rect.height * 0.3);
                            tooltip.style.right = 'auto'; tooltip.style.left = `${startX}px`; tooltip.style.top = `${startY}px`;
                        }

                        if (tooltipTimeline) tooltipTimeline.kill();
                        tooltipTimeline = gsap.timeline();
                        tooltipTimeline.set(tooltipLine, { width: 0 }).set(tooltipContent, { opacity: 0, y: 10 })
                            .to(tooltipLine, { width: 80, duration: 0.4, ease: "power2.out" })
                            .to(tooltipContent, { opacity: 1, y: 0, duration: 0.4, ease: "back.out(1.7)" }, "-=0.2");
                    });

                    element.addEventListener('mouseleave', function() {
                        if (tooltipTimeline) tooltipTimeline.kill();
                        tooltip.style.display = 'none';
                    });

                    // [Click Event - í•µì‹¬ ë¡œì§ ë¶„ê¸°]
                    element.addEventListener('click', (e) => {
                        e.stopPropagation();
                        tooltip.style.display = 'none';

                        // 1. ê³µí†µ íŠ¸ëœì§€ì…˜ íš¨ê³¼ (ì¤Œì¸ & í™”ì´íŠ¸ì•„ì›ƒ)
                        const runTransition = (callback) => {
                            gsap.timeline()
                                .to(element, { scale: 1.2, duration: 0.2, ease: "back.in(2)", zIndex: 100 }) 
                                .to("#svg-container", { scale: 5, opacity: 0, duration: 0.8, ease: "power4.in" })
                                .to(overlay, { opacity: 1, duration: 0.5 }, "<0.3")
                                .to({}, { onComplete: callback });
                        };

                        if (!isDetailMode) {
                            // [ì „êµ­ ì§€ë„ ëª¨ë“œ]
                            // REGION_DATAì— í•´ë‹¹ regionIdê°€ Keyë¡œ ì¡´ì¬í•˜ë©´ ìƒì„¸ ì§€ë„ê°€ ìˆëŠ” ê³³ (Case 2)
                            if (REGION_DATA[regionId]) {
                                // Case 2: ìƒì„¸ ì§€ë„ë¡œ ì´ë™ (í˜ì´ì§€ ë¦¬ë¡œë“œ ?region=...)
                                runTransition(() => {
                                    window.location.search = `?region=${regionId}`;
                                });
                            } else {
                                // Case 1: ìƒì„¸ ì§€ë„ê°€ ì—†ëŠ” ê³³ (ê°•ì›, ì œì£¼, ì „ë¶, ì¶©ë¶)
                                // -> ë°”ë¡œ main.htmlë¡œ ì´ë™í•˜ë©° ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ì „ë‹¬
                                runTransition(() => {
                                    window.location.href = `main.html?region=${regionId}`;
                                });
                            }
                        } else {
                            // [ìƒì„¸ ì§€ë„ ëª¨ë“œ]
                            // Case 2ì˜ 2ë‹¨ê³„: ìƒì„¸ ì§€ì—­(ì˜ˆ: detail_daegu) í´ë¦­ ì‹œ main.htmlë¡œ ì´ë™
                            runTransition(() => {
                                window.location.href = `main.html?region=${regionId}`;
                            });
                        }
                    });

                } else {
                    // ë§¤ì¹­ ì‹¤íŒ¨ ì‹œ ë¹„í™œì„± ì²˜ë¦¬
                    element.classList.add('region-disabled');
                }
            });
        }

        document.addEventListener("DOMContentLoaded", () => {
            const mainContent = document.getElementById('main-content');
            const introGate = document.getElementById('intro-gate');
            const introContent = document.getElementById('intro-content');
            const btnStart = document.getElementById('btn-start');
            const backNav = document.getElementById('back-nav');
            const headerTitle = document.getElementById('header-title');
            const headerDesc = document.getElementById('header-desc');

            headerTitle.innerText = `Sseuk-Sseuk : ${currentConfig.title}`;
            headerDesc.innerText = currentConfig.desc;

            // UI ë¶„ê¸° ì²˜ë¦¬
            if (isDetailMode) {
                introGate.classList.remove('flex');
                introGate.classList.add('hidden');
                backNav.classList.remove('hidden');
            } else {
                introGate.classList.remove('hidden');
                introGate.classList.add('flex');
                gsap.to(introContent, {
                    opacity: 1, y: 0, duration: 0.8, ease: "back.out(1.7)", delay: 0.2
                });
                if(btnStart) {
                    btnStart.addEventListener('click', () => {
                        gsap.to(introGate, {
                            opacity: 0, duration: 0.8, ease: "power2.inOut",
                            onComplete: () => { introGate.style.display = 'none'; }
                        });
                    });
                }
            }

            fetch(currentConfig.mapPath)
                .then(res => {
                    if(!res.ok) throw new Error("Map file error");
                    return res.text();
                })
                .then(text => {
                    document.getElementById('svg-container').innerHTML = text;
                    initMapEvents();
                    mainContent.classList.remove('hidden');
                    gsap.to(mainContent, { opacity: 1, duration: 0.5 });
                })
                .catch(err => {
                    console.error(err);
                    document.getElementById('svg-container').innerHTML = "<p class='text-red-500'>ì§€ë„ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>";
                });
        });
    </script>
</body>
</html>