<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sseuk-Sseuk : ì§€ì—­ ì†Œì‹</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        /* [1] ì§€ë„ ì»¨í…Œì´ë„ˆ ë° SVG ë°˜ì‘í˜• ì„¤ì • */
        #svg-container {
            perspective: 1000px;
            overflow: visible;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #svg-container svg {
            width: 100% !important;
            height: auto !important;
            max-height: 80vh !important;
            max-width: 100% !important;
            display: block;
            transform-origin: center center;
            overflow: visible;
        }

        /* [2] í¼ì¦ ì¡°ê° ìŠ¤íƒ€ì¼ */
        .puzzle-piece { cursor: pointer; transform-style: preserve-3d; transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); }
        
        g.puzzle-piece path, path.puzzle-piece { 
            fill: #ffffff; stroke: #4A9EA8; stroke-width: 1px; 
            filter: drop-shadow(0px 4px 0px #4A9EA8) drop-shadow(0px 5px 5px rgba(0, 0, 0, 0.1)); 
            transition: all 0.4s ease; 
        }

        /* í˜¸ë²„ íš¨ê³¼ */
        .puzzle-piece:hover { transform: translateZ(20px) translateY(-15px); z-index: 50; }
        .puzzle-piece:hover path, path.puzzle-piece:hover { 
            filter: drop-shadow(0px 15px 0px #4A9EA8) drop-shadow(0px 25px 30px rgba(74, 158, 168, 0.4)); 
        }

        /* [3] ë¹„í™œì„± ì˜ì—­ */
        .region-disabled { pointer-events: none; opacity: 0.5; }
        .region-disabled path, path.region-disabled { fill: #eeeeee; stroke: #dddddd; filter: none; }

        /* [4] UI ìš”ì†Œ (íˆ´íŒ) */
        #info-tooltip { position: absolute; top: 0; left: 0; pointer-events: none; z-index: 100; display: none; align-items: center; }
        .tooltip-line { height: 1px; background-color: #4A9EA8; box-shadow: 0 0 5px #4A9EA8; }
        .tooltip-content { display: flex; flex-direction: column; opacity: 0; }
        .tooltip-badge { font-size: 10px; background-color: #E0BA76; color: white; padding: 2px 6px; border-radius: 9999px; margin-bottom: 4px; font-weight: bold; width: fit-content; }
        .tooltip-title { font-size: 1.5rem; font-weight: 800; color: #374151; line-height: 1; margin-bottom: 4px; }
        .tooltip-count { font-size: 1rem; color: #6B7280; font-weight: 500; }
        .tooltip-count span { color: #4A9EA8; font-weight: 700; }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        #auth-modal { backdrop-filter: blur(8px); }
        .auth-input {
            width: 100%;
            padding: 12px 16px;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
            background-color: #f9fafb;
            outline: none;
            transition: all 0.2s ease;
        }
        .auth-input:focus {
            background-color: #fff;
            border-color: #4A9EA8;
            box-shadow: 0 0 0 4px rgba(74, 158, 168, 0.1);
        }

        /* íŠ¸ëœì§€ì…˜ìš© í™”ì´íŠ¸ì•„ì›ƒ ì˜¤ë²„ë ˆì´ */
        #transition-overlay { position: fixed; inset: 0; background-color: white; z-index: 9999; pointer-events: none; opacity: 0; }

        /* ë°°ê²½ */
        body {
            background-color: #f9fafb;
            background-image: 
                radial-gradient(#4A9EA8 1.5px, transparent 1.5px),
                radial-gradient(#F48245 1.5px, transparent 1.5px),
                radial-gradient(#D9B36C 1.5px, transparent 1.5px);
            background-size: 75px 75px;
            background-position: 0 0, 25px 25px, 50px 50px;
            animation: particleMove 60s linear infinite;
        }
        @keyframes particleMove {
            0% { background-position: 0 0, 25px 25px, 50px 50px; }
            100% { background-position: 750px 0, 775px 25px, 800px 50px; }
        }
    </style>
</head>

<body class="text-gray-900 overflow-hidden h-screen flex flex-col relative font-sans">

    <div id="transition-overlay"></div>

    <div id="intro-gate" class="fixed inset-0 z-[60] flex flex-col items-center justify-center bg-gray-50/90 backdrop-blur-md transition-all duration-700 hidden">
        <div class="text-center space-y-8 opacity-0 translate-y-10" id="intro-content">
            <div class="space-y-2">
                <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 tracking-tight">
                    ë‹¹ì‹ ì˜ <span class="text-[#4A9EA8]">ì§€ì—­</span>ì„<br>íƒìƒ‰í•´ë³´ì„¸ìš”
                </h1>
                <p class="text-gray-500 text-lg">ë‚´ê°€ ì‚¬ëŠ” ê³³ì˜ ì²­ë…„ ì •ì±…ì„ ê°€ì¥ ì‰½ê³  ë¹ ë¥´ê²Œ.</p>
            </div>
            <div class="flex flex-col gap-3 w-full max-w-xs mx-auto">
                <button id="btn-start" class="w-full py-4 bg-[#4A9EA8] hover:bg-[#3b858e] text-white font-bold rounded-xl shadow-lg shadow-teal-500/30 transition-all hover:-translate-y-1 text-lg flex items-center justify-center gap-2">
                    <span>ì§€ë„ì—ì„œ ì§€ì—­ ì°¾ê¸°</span>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                </button>
            </div>
            <div class="pt-4 border-t border-gray-200 w-full max-w-xs mx-auto">
                <p class="text-sm text-gray-500 mb-2">ì´ë¯¸ ë‚˜ë§Œì˜ êµ¬ì—­ì´ ìˆìœ¼ì‹ ê°€ìš”?</p>
                <button id="btn-intro-login" class="text-[#4A9EA8] font-bold hover:underline text-base">
                    ê¸°ì¡´ íšŒì› ë¡œê·¸ì¸ &rarr;
                </button>
            </div>
        </div>
    </div>

    <div id="auth-modal" class="fixed inset-0 z-[70] flex items-center justify-center bg-black/40 hidden opacity-0 transition-opacity duration-300">
        <div class="bg-white rounded-3xl shadow-2xl p-8 max-w-sm w-full mx-4 transform scale-95 transition-transform duration-300 relative overflow-hidden" id="auth-modal-content">
            
            <button id="btn-modal-close-icon" class="absolute top-5 right-5 text-gray-400 hover:text-gray-600 z-10 p-1 hover:bg-gray-100 rounded-full transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>

            <div id="auth-view-promo" class="flex flex-col items-center text-center transition-all duration-300">
                <div class="w-16 h-16 bg-teal-50 rounded-2xl flex items-center justify-center mb-6 shadow-inner">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-[#4A9EA8]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                </div>
                
                <h2 id="auth-title" class="text-2xl font-bold text-gray-900 mb-2"></h2>
                <p id="auth-desc" class="text-gray-500 text-sm mb-8 leading-relaxed"></p>

                <div class="space-y-3 w-full">
                    <button id="btn-modal-signup-trigger" class="w-full py-3.5 bg-[#4A9EA8] hover:bg-[#3b858e] text-white font-bold rounded-xl shadow-lg shadow-teal-500/20 transition-all hover:-translate-y-0.5">
                        3ì´ˆ ë§Œì— ê°€ì…í•˜ê³  ë³´ê¸° ğŸš€
                    </button>
                    <button id="btn-switch-to-login" class="w-full py-3.5 border border-gray-200 text-gray-600 font-bold rounded-xl hover:bg-gray-50 hover:border-gray-300 transition-colors">
                        ë¡œê·¸ì¸
                    </button>
                </div>
            </div>

            <div id="auth-view-login" class="hidden flex-col items-center text-center transition-all duration-300">
                <div class="w-16 h-16 bg-teal-50 rounded-2xl flex items-center justify-center mb-6 shadow-inner">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-[#4A9EA8]" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M10 2a1 1 0 00-1 1v1a1 1 0 01-1 1H7a1 1 0 01-1-1V3a1 1 0 00-1-1H4a2 2 0 00-2 2v15a2 2 0 002 2h16a2 2 0 002-2V4a2 2 0 00-2-2h-1a1 1 0 00-1 1v1a1 1 0 01-1 1h-1a1 1 0 01-1-1V3a1 1 0 00-1-1h-3z" opacity="0.2"/>
                        <path fill-rule="evenodd" d="M13.5 19.5h-9a1.5 1.5 0 01-1.5-1.5v-9a1.5 1.5 0 011.5-1.5h9a1.5 1.5 0 011.5 1.5v9a1.5 1.5 0 01-1.5 1.5zM12 15a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
                    </svg>
                </div>
                
                <h2 class="text-2xl font-bold text-gray-900 mb-2">í™˜ì˜í•©ë‹ˆë‹¤!</h2>
                <p class="text-gray-500 text-sm mb-6">ì„¤ì •í•´ë‘” ë‚´ êµ¬ì—­ìœ¼ë¡œ ë¹ ë¥´ê²Œ ì´ë™í•˜ì„¸ìš”.</p>

                <div class="w-full space-y-3 mb-6">
                    <input type="text" id="login-id" placeholder="ì•„ì´ë””" class="auth-input">
                    <input type="password" id="login-pw" placeholder="ë¹„ë°€ë²ˆí˜¸" class="auth-input">
                </div>

                <div class="space-y-3 w-full">
                    <button id="btn-login-submit" class="w-full py-3.5 bg-[#4A9EA8] hover:bg-[#3b858e] text-white font-bold rounded-xl shadow-lg shadow-teal-500/20 transition-all hover:-translate-y-0.5 flex items-center justify-center gap-2">
                        <span>ë¡œê·¸ì¸</span>
                    </button>
                    <button id="btn-switch-to-promo" class="w-full py-3.5 text-gray-400 text-sm hover:text-gray-600 underline decoration-gray-300">
                        ì•„ì§ ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”?
                    </button>
                </div>
            </div>
            
            <button id="btn-modal-browse" class="mt-6 text-xs text-gray-400 font-medium w-full text-center hover:text-[#4A9EA8] transition-colors">
                ì˜¤ëŠ˜ì€ ê·¸ëƒ¥ ë‘˜ëŸ¬ë³´ê¸° &rarr;
            </button>
        </div>
    </div>

    <div id="back-nav" class="fixed top-6 left-6 z-50 hidden">
        <button onclick="window.location.href='/'" class="flex items-center gap-2 px-4 py-2 bg-white/90 backdrop-blur rounded-full shadow-lg border border-gray-100 hover:bg-[#4A9EA8] hover:text-white transition-all group cursor-pointer">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 transition-transform group-hover:-translate-x-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
            <span class="font-bold text-sm">ì „êµ­ì§€ë„ ë³´ê¸°</span>
        </button>
    </div>

    <div id="info-tooltip">
        <div class="tooltip-line"></div>
        <div class="tooltip-content">
            <span class="tooltip-badge">Region</span>
            <h3 class="tooltip-title">ì§€ì—­ëª…</h3>
            <p class="tooltip-count">ë°ì´í„° : <span>0</span>ê±´</p>
        </div>
    </div>

    <div id="main-content" class="relative w-full h-full flex flex-col items-center justify-center opacity-0 hidden p-4">
        <header class="text-center z-10 flex-none mb-6 md:mb-10 pointer-events-none">
            <h1 class="text-3xl md:text-4xl font-bold tracking-tighter mb-2" id="header-title">ì“±ì“± í”„ë¡œì íŠ¸</h1>
            <p class="text-sm md:text-base text-gray-500" id="header-desc">ì§€ë„ë¥¼ í´ë¦­í•˜ì—¬ ì§€ì—­ë³„ ë‰´ìŠ¤ë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
        </header>
        <main id="svg-container" class="w-full max-w-5xl flex items-center justify-center flex-1">
            </main>
    </div>

    <script>
        // ... (ì´ì „ê³¼ ë™ì¼í•œ ë°ì´í„° ì„¤ì •) ...
        const REGION_DATA = {
            'national': {
                mapPath: '/static/images/map.svg',
                title: 'ì „êµ­ ì†Œì‹',
                desc: 'ì§€ë„ë¥¼ í´ë¦­í•˜ì—¬ ì§€ì—­ë³„ ë‰´ìŠ¤ë¥¼ í™•ì¸í•˜ì„¸ìš”',
                db: {
                    'metropolitan': { name: 'ì„œìš¸/ê²½ê¸°/ì¸ì²œ', count: 4250 },
                    'chungnam': { name: 'ì¶©ë‚¨/ëŒ€ì „/ì„¸ì¢…', count: 589 },
                    'jeonnam': { name: 'ì „ë‚¨/ê´‘ì£¼', count: 340 },
                    'gyeongbug': { name: 'ê²½ë¶/ëŒ€êµ¬', count: 781 },
                    'gyeongnam': { name: 'ê²½ë‚¨/ë¶€ì‚°/ìš¸ì‚°', count: 890 },
                    'gangwon': { name: 'ê°•ì›ë„', count: 231 },
                    'chungbug': { name: 'ì¶©ì²­ë¶ë„', count: 412 },
                    'jeonbug': { name: 'ì „ë¼ë¶ë„', count: 620 },
                    'jeju': { name: 'ì œì£¼íŠ¹ë³„ìì¹˜ë„', count: 156 }
                },
                leftSideIds: ['metropolitan', 'chungnam', 'jeonbug', 'jeonnam', 'jeju']
            },
            'metropolitan': {
                mapPath: '/static/images/total_metropolitan.svg',
                title: 'ìˆ˜ë„ê¶Œ ìƒì„¸',
                desc: 'ì§€ì—­ì„ ì„ íƒí•˜ì„¸ìš”',
                db: {
                    'detail_seoul': { name: 'ì„œìš¸íŠ¹ë³„ì‹œ', count: 1200 },
                    'detail_incheon': { name: 'ì¸ì²œê´‘ì—­ì‹œ', count: 450 },
                    'detail_gyeonggi': { name: 'ê²½ê¸°ë„', count: 2100 }
                }
            },
            'chungnam': {
                mapPath: '/static/images/total_chungnam.svg',
                title: 'ì¶©ë‚¨/ëŒ€ì „/ì„¸ì¢… ìƒì„¸',
                desc: 'ì§€ì—­ì„ ì„ íƒí•˜ì„¸ìš”',
                db: {
                    'detail_daejun': { name: 'ëŒ€ì „ê´‘ì—­ì‹œ', count: 320 },
                    'detail_saejong': { name: 'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ', count: 150 },
                    'detail_chungnam': { name: 'ì¶©ì²­ë‚¨ë„', count: 480 }
                }
            },
            'jeonnam': {
                mapPath: '/static/images/total_jeonnam.svg',
                title: 'ì „ë‚¨/ê´‘ì£¼ ìƒì„¸',
                desc: 'ì§€ì—­ì„ ì„ íƒí•˜ì„¸ìš”',
                db: {
                    'detail_gwangju': { name: 'ê´‘ì£¼ê´‘ì—­ì‹œ', count: 290 },
                    'detail_jeonnam': { name: 'ì „ë¼ë‚¨ë„', count: 310 }
                }
            },
            'gyeongbug': {
                mapPath: '/static/images/total_gyeongbug.svg',
                title: 'ê²½ë¶/ëŒ€êµ¬ ìƒì„¸',
                desc: 'ì§€ì—­ì„ ì„ íƒí•˜ì„¸ìš”',
                db: {
                    'detail_daegu': { name: 'ëŒ€êµ¬ê´‘ì—­ì‹œ', count: 410 },
                    'detail_gyeongbug': { name: 'ê²½ìƒë¶ë„', count: 520 }
                }
            },
            'gyeongnam': {
                mapPath: '/static/images/total_gyeongnam.svg',
                title: 'ê²½ë‚¨/ë¶€ì‚°/ìš¸ì‚°',
                desc: 'ì§€ì—­ì„ ì„ íƒí•˜ì„¸ìš”',
                db: {
                    'detail_busan': { name: 'ë¶€ì‚°ê´‘ì—­ì‹œ', count: 680 },
                    'detail_ulsan': { name: 'ìš¸ì‚°ê´‘ì—­ì‹œ', count: 210 },
                    'detail_gyeongnam': { name: 'ê²½ìƒë‚¨ë„', count: 550 }
                }
            }
        };

        const urlParams = new URLSearchParams(window.location.search);
        const currentRegionKey = urlParams.get('region') || 'national';
        const currentConfig = REGION_DATA[currentRegionKey] || REGION_DATA['national'];
        const isDetailMode = currentRegionKey !== 'national';
        let isLoggedIn = sessionStorage.getItem('sseuk_logged_in') === 'true';

        // =========================================================================
        // [2] íŒì—…(ëª¨ë‹¬) ë¡œì§ - View Switching í¬í•¨
        // =========================================================================
        const modal = {
            el: document.getElementById('auth-modal'),
            content: document.getElementById('auth-modal-content'),
            
            // Views
            viewPromo: document.getElementById('auth-view-promo'),
            viewLogin: document.getElementById('auth-view-login'),
            
            // Elements in Promo View
            title: document.getElementById('auth-title'),
            desc: document.getElementById('auth-desc'),
            btnSignupTrigger: document.getElementById('btn-modal-signup-trigger'),
            btnSwitchToLogin: document.getElementById('btn-switch-to-login'),
            
            // Elements in Login View
            inputID: document.getElementById('login-id'),
            inputPW: document.getElementById('login-pw'),
            btnLoginSubmit: document.getElementById('btn-login-submit'),
            btnSwitchToPromo: document.getElementById('btn-switch-to-promo'),
            
            // Common
            btnBrowse: document.getElementById('btn-modal-browse'),
            btnCloseIcon: document.getElementById('btn-modal-close-icon'),
            
            // State
            targetCallback: null,

            // ëª¨ë‹¬ ì—´ê¸° (ê¸°ë³¸ì ìœ¼ë¡œ Promo ë·°ë¥¼ ë¨¼ì € ë³´ì—¬ì¤Œ, startModeë¡œ ë³€ê²½ ê°€ëŠ¥)
            show: function(regionName, count, navigateCallback, startMode = 'promo') {
                this.targetCallback = navigateCallback;
                this.el.classList.remove('hidden');
                
                // ì• ë‹ˆë©”ì´ì…˜
                gsap.to(this.el, { opacity: 1, duration: 0.3 });
                gsap.to(this.content, { scale: 1, duration: 0.3, ease: 'back.out(1.2)' });

                // ë°ì´í„° ë°”ì¸ë”©
                if(regionName) {
                    this.title.innerHTML = `<span class="text-[#4A9EA8]">${regionName}</span> ì†Œì‹ì„<br>ë°›ì•„ë³´ì‹œê² ìŠµë‹ˆê¹Œ?`;
                    this.desc.innerHTML = `ì´ ${count.toLocaleString()}ê±´ì˜ ì²­ë…„ ì •ì±…ì„<br>ë†“ì¹˜ì§€ ë§ê³  í™•ì¸í•˜ì„¸ìš”.`;
                }

                // ë·° ì´ˆê¸°í™”
                this.switchView(startMode);
                
                // ì´ë²¤íŠ¸ ë°”ì¸ë”©
                this.bindEvents();
            },

            switchView: function(mode) {
                if (mode === 'login') {
                    this.viewPromo.classList.add('hidden');
                    this.viewLogin.classList.remove('hidden');
                    this.viewLogin.classList.add('flex');
                    this.inputID.focus();
                } else {
                    this.viewLogin.classList.add('hidden');
                    this.viewLogin.classList.remove('flex');
                    this.viewPromo.classList.remove('hidden');
                }
            },
            
            bindEvents: function() {
                // 1. Promo -> Login ì „í™˜
                this.btnSwitchToLogin.onclick = () => this.switchView('login');
                
                // 2. Login -> Promo ì „í™˜
                this.btnSwitchToPromo.onclick = () => this.switchView('promo');

                // 3. ë¹ ë¥¸ ê°€ì… (ì‹œë®¬ë ˆì´ì…˜)
                this.btnSignupTrigger.onclick = () => {
                    this.completeAuth("ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!");
                };

                // 4. ë¡œê·¸ì¸ ì œì¶œ (ë°ì´í„° ì „ì†¡ ì‹œë®¬ë ˆì´ì…˜)
                this.btnLoginSubmit.onclick = () => {
                    const id = this.inputID.value;
                    const pw = this.inputPW.value;
                    if(!id || !pw) {
                        alert("ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                        return;
                    }
                    // TODO: ì—¬ê¸°ì„œ DB ë‹´ë‹¹ìê°€ ë§Œë“¤ì–´ì¤€ APIë¡œ ì „ì†¡
                    console.log(`[Send to DB] ID: ${id}, PW: ${pw}`); 
                    this.completeAuth("ë¡œê·¸ì¸ ë˜ì—ˆìŠµë‹ˆë‹¤.");
                };

                // 5. ë‘˜ëŸ¬ë³´ê¸° (ë¹„ë¡œê·¸ì¸ ì´ë™)
                this.btnBrowse.onclick = () => {
                    this.hide();
                    // ë¹„ë¡œê·¸ì¸ ìƒíƒœë¡œ ì½œë°± ì‹¤í–‰
                    if(this.targetCallback) this.targetCallback();
                };

                // 6. ë‹«ê¸°
                this.btnCloseIcon.onclick = () => this.hide();
            },

            completeAuth: function(msg) {
                this.hide();
                alert(msg); // ì‹¤ì œë¡œëŠ” í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ì¶”ì²œ
                sessionStorage.setItem('sseuk_logged_in', 'true');
                isLoggedIn = true;
                if(this.targetCallback) this.targetCallback();
            },
            
            hide: function() {
                gsap.to(this.el, { opacity: 0, duration: 0.2 });
                gsap.to(this.content, { scale: 0.95, duration: 0.2, onComplete: () => {
                    this.el.classList.add('hidden');
                    // Input ì´ˆê¸°í™”
                    this.inputID.value = "";
                    this.inputPW.value = "";
                }});
            }
        };

        // =========================================================================
        // [3] ì§€ë„ ì´ë²¤íŠ¸
        // =========================================================================
        function initMapEvents() {
            const svgElement = document.querySelector('#svg-container svg');
            if (!svgElement) return;

            svgElement.removeAttribute('width');
            svgElement.removeAttribute('height');
            
            const tooltip = document.querySelector('#info-tooltip');
            const tTitle = tooltip.querySelector('.tooltip-title');
            const tCountSpan = tooltip.querySelector('.tooltip-count span');
            const overlay = document.getElementById('transition-overlay');

            const activeIds = Object.keys(currentConfig.db);
            const allElements = svgElement.querySelectorAll('g, path');
            let tooltipTimeline = null;

            allElements.forEach(element => {
                const rawId = element.id || '';
                const regionId = rawId.trim();

                if (!regionId) return;
                if (!isDetailMode && regionId.endsWith('_st')) return; 
                if (isDetailMode && (regionId.startsWith('total_') || regionId.includes('.svg'))) return; 
                if (regionId.toLowerCase().includes('lm')) {
                    element.classList.add('landmark-piece');
                    return; 
                }

                if (activeIds.includes(regionId)) {
                    element.classList.add('puzzle-piece');

                    element.addEventListener('mouseenter', function() {
                        if (this.tagName.toLowerCase() === 'path' || this.tagName.toLowerCase() === 'g') {
                             this.parentNode.appendChild(this); 
                        }
                        const data = currentConfig.db[regionId] || { name: 'Unknown', count: 0 };
                        tTitle.innerText = data.name;
                        tCountSpan.innerText = data.count.toLocaleString();
                        
                        tooltip.style.display = 'flex';
                        const rect = element.getBoundingClientRect();
                        const isLeft = (!isDetailMode) ? (currentConfig.leftSideIds || []).includes(regionId) : (rect.left + rect.width/2) < (window.innerWidth / 2);
                        const tLine = tooltip.querySelector('.tooltip-line');
                        const tContent = tooltip.querySelector('.tooltip-content');

                        if (isLeft) {
                            tooltip.style.flexDirection = 'row-reverse';
                            tLine.style.marginRight = '0px'; tLine.style.marginLeft = '10px'; tLine.style.transformOrigin = 'right center';
                            tContent.style.alignItems = 'flex-end';
                            const startX = rect.left + (rect.width * 0.2); const startY = rect.top + (rect.height * 0.3);
                            tooltip.style.left = 'auto'; tooltip.style.right = `${window.innerWidth - startX}px`; tooltip.style.top = `${startY}px`;
                        } else {
                            tooltip.style.flexDirection = 'row';
                            tLine.style.marginRight = '10px'; tLine.style.marginLeft = '0px'; tLine.style.transformOrigin = 'left center';
                            tContent.style.alignItems = 'flex-start';
                            const startX = rect.right - (rect.width * 0.2); const startY = rect.top + (rect.height * 0.3);
                            tooltip.style.right = 'auto'; tooltip.style.left = `${startX}px`; tooltip.style.top = `${startY}px`;
                        }
                        
                        if (tooltipTimeline) tooltipTimeline.kill();
                        tooltipTimeline = gsap.timeline();
                        tooltipTimeline.set(tLine, { width: 0 }).set(tContent, { opacity: 0, y: 10 })
                            .to(tLine, { width: 80, duration: 0.4, ease: "power2.out" })
                            .to(tContent, { opacity: 1, y: 0, duration: 0.4, ease: "back.out(1.7)" }, "-=0.2");
                    });

                    element.addEventListener('mouseleave', function() {
                        if (tooltipTimeline) tooltipTimeline.kill();
                        tooltip.style.display = 'none';
                    });

                    element.addEventListener('click', (e) => {
                        e.stopPropagation();
                        tooltip.style.display = 'none';

                        const data = currentConfig.db[regionId];
                        const hasDetailMap = REGION_DATA.hasOwnProperty(regionId);

                        // 1. ì „êµ­ ì§€ë„ & ìƒì„¸ ì§€ë„ ìˆìŒ -> ì¦‰ì‹œ ì´ë™
                        if (!isDetailMode && hasDetailMap) {
                            performTransition(() => {
                                window.location.search = `?region=${regionId}`;
                            });
                            return; 
                        }

                        // 2. ê·¸ ì™¸ (ì „êµ­&ìƒì„¸ì—†ìŒ OR ìƒì„¸ì§€ë„ë‚´ë¶€) -> ë¡œê·¸ì¸ ì²´í¬
                        const targetUrl = `main.html?region=${regionId}`;
                        
                        if (isLoggedIn) {
                            performTransition(() => { window.location.href = targetUrl; });
                        } else {
                            // íŒì—… ì˜¤í”ˆ
                            modal.show(data.name, data.count, 
                                () => { performTransition(() => { window.location.href = targetUrl; }); }
                            );
                        }
                    });

                } else {
                    element.classList.add('region-disabled');
                }
            });

            function performTransition(callback) {
                gsap.timeline()
                    .to("#svg-container", { scale: 5, opacity: 0, duration: 0.8, ease: "power4.in" })
                    .to(overlay, { opacity: 1, duration: 0.5 }, "<0.3")
                    .to({}, { onComplete: callback });
            }
        }

        // =========================================================================
        // [4] ì‹¤í–‰ë¶€
        // =========================================================================
        document.addEventListener("DOMContentLoaded", () => {
            const mainContent = document.getElementById('main-content');
            const introGate = document.getElementById('intro-gate');
            const introContent = document.getElementById('intro-content');
            const btnStart = document.getElementById('btn-start');
            const btnIntroLogin = document.getElementById('btn-intro-login');
            const backNav = document.getElementById('back-nav');
            const headerTitle = document.getElementById('header-title');
            const headerDesc = document.getElementById('header-desc');

            headerTitle.innerText = `Sseuk-Sseuk : ${currentConfig.title}`;
            headerDesc.innerText = currentConfig.desc;

            const hasVisited = sessionStorage.getItem('sseuk_intro_visited');

            if (isDetailMode || hasVisited || isLoggedIn) {
                introGate.classList.add('hidden');
                if (isDetailMode) backNav.classList.remove('hidden');
                mainContent.classList.remove('hidden');
                mainContent.style.opacity = 1;
            } else {
                introGate.classList.remove('hidden');
                introGate.classList.add('flex');
                
                gsap.to(introContent, { opacity: 1, y: 0, duration: 0.8, ease: "back.out(1.7)", delay: 0.2 });

                btnStart.addEventListener('click', () => {
                    sessionStorage.setItem('sseuk_intro_visited', 'true');
                    gsap.to(introGate, {
                        opacity: 0, duration: 0.8, ease: "power2.inOut",
                        onComplete: () => { introGate.style.display = 'none'; }
                    });
                });

                // ì¸íŠ¸ë¡œì˜ 'ê¸°ì¡´ íšŒì› ë¡œê·¸ì¸' ë²„íŠ¼
                btnIntroLogin.addEventListener('click', () => {
                    // ë°”ë¡œ ë¡œê·¸ì¸ ë·°ë¡œ ì‹œì‘, ì½œë°±ì€ ì—†ìœ¼ë¯€ë¡œ(ì¸íŠ¸ë¡œë‹ˆê¹Œ) ê·¸ëƒ¥ reloadë‚˜ ë©”ì¸ ì´ë™
                    modal.show(null, 0, () => {
                        window.location.reload(); 
                    }, 'login');
                });
            }

            fetch(currentConfig.mapPath)
                .then(res => {
                    if(!res.ok) throw new Error("Map file error");
                    return res.text();
                })
                .then(text => {
                    document.getElementById('svg-container').innerHTML = text;
                    initMapEvents();
                    if(!introGate.classList.contains('hidden')) {
                         mainContent.classList.remove('hidden');
                         gsap.to(mainContent, { opacity: 1, duration: 0.5 });
                    }
                })
                .catch(err => {
                    console.error(err);
                    document.getElementById('svg-container').innerHTML = "<p class='text-red-500'>ì§€ë„ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>";
                });
        });
    </script>
</body>
</html>